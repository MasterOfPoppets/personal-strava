!function(){"use strict";angular.module("gh.strava.activities",[]).controller("ActivitiesCtrl",["$scope","$http",function($scope,$http){$scope.model={};var width=420,barHeight=20,x=d3.scale.linear().range([0,width]),chart=d3.select(".chart").attr("width",width);$http.get("/activities").success(function(data){$scope.model.activities=data,x.domain([0,d3.max(data,function(d){return d.total_elevation_gain})]),chart.attr("height",barHeight*data.length);var bar=chart.selectAll("g").data(data).enter().append("g").attr("transform",function(d,i){return"translate(0,"+i*barHeight+")"});bar.append("rect").attr("width",function(d){return x(d.total_elevation_gain)}).attr("height",barHeight-1),bar.append("text").attr("x",function(d){return x(d.total_elevation_gain)-3}).attr("y",barHeight/2).attr("dy",".35em").text(function(d){return d.name})})}]).controller("ActivityCtrl",["$scope","$http","$stateParams",function($scope,$http,$stateParams){var httpGetObject={method:"GET",url:"/activities/"+$stateParams.id};$http(httpGetObject).success(function(data){console.log(data)})}])}(),function(){"use strict";angular.module("gh.strava.dashboard",[]).controller("DashboardCtrl",["$scope","UserFactory",function($scope,UserFactory){$scope.User=UserFactory.User}])}(),function(){"use strict";angular.module("gh.strava.factories.charts",[]).factory("DoughnutFactory",function(){return{draw:function(chart,data){if(null===chart.doughnut)chart.doughnut=new Chart(chart.ctx).Doughnut(data);else for(var i=0;i<Object.keys(chart.data).length;i++)chart.doughnut.segments[i].value=data[i].value}}})}(),function(){"use strict";angular.module("gh.strava.factories.hr",[]).factory("HRStreamFactory",["$http",function($http){return{processHRStream:function(route,next){$http.get(route).success(function(data){next(0===Object.keys(data).length?{}:[{value:parseFloat(data.rest),color:"#ffe1e2",label:"Rest"},{value:parseFloat(data.z1),color:"#ffbbbd",label:"Zone 1"},{value:parseFloat(data.z2),color:"#fc9294",label:"Zone 2"},{value:parseFloat(data.z3),color:"#fc6468",label:"Zone 3"},{value:parseFloat(data.z4),color:"#f8363a",label:"Zone 4"},{value:parseFloat(data.z5),color:"#ef1419",label:"Zone 5"}])})}}}])}(),function(){"use strict";angular.module("gh.strava",["ui.router","gh.strava.user","gh.strava.oauth","gh.strava.dashboard","gh.strava.activities","gh.strava.segments"]).config(["$stateProvider","$urlRouterProvider","$locationProvider",function($stateProvider,$urlRouterProvider,$locationProvider){$urlRouterProvider.otherwise("/"),$locationProvider.html5Mode(!0),$stateProvider.state("authorise",{url:"/",templateUrl:"partials/oauth",controller:"AuthoriseCtrl"}).state("exchange",{url:"/exchange?state&code",resolve:{code:["$stateParams",function($stateParams){return $stateParams.code}]},controller:"ExchangeCtrl"}).state("dashboard",{"abstract":!0,templateUrl:"partials/dashboard",controller:"DashboardCtrl"}).state("dashboard.userConfig",{url:"/user",templateUrl:"partials/userConfig",controller:"UserConfigCtrl"}).state("dashboard.activities",{url:"/activities",templateUrl:"partials/activities",controller:"ActivitiesCtrl"}).state("dashboard.activity",{url:"/activities/:id",templateUrl:"partials/activity",controller:"ActivityCtrl"}).state("dashboard.segments",{url:"/segments",templateUrl:"partials/segments",controller:"SegmentsCtrl"})}])}(),function(){"use strict";angular.module("gh.strava.oauth",[]).controller("AuthoriseCtrl",["$scope","$http","$window",function($scope,$http,$window){$scope.authorise=function(){$http.get("/oauth/connect").success(function(data){$window.location.href=data})}}]).controller("ExchangeCtrl",["$scope","$http","code","UserFactory","$state",function($scope,$http,code,UserFactory,$state){$http.get("/oauth/exchange?code="+code).success(function(data){console.log(data),UserFactory.setUser(data),data.hrZonesSet?$state.go("dashboard.activities",{location:!0,inherit:!1}):$state.go("dashboard.userConfig",{location:!0,inherit:!1})})}])}(),function(){"use strict";angular.module("gh.strava.segments",[]).controller("SegmentsCtrl",["$scope","$http",function($scope,$http){$scope.model={},$http.get("/segments").success(function(data){$scope.model.segments=data})}])}(),function(){"use strict";angular.module("gh.strava.user",[]).factory("UserFactory",function(){var user={};return{User:user,setUser:function(data){for(var key in data)user[key]=data[key]}}}).controller("UserConfigCtrl",["$scope","$http","UserFactory",function($scope,$http,UserFactory){$scope.User=UserFactory.User,$scope.model={hrzones:UserFactory.User.hrZones},$http.get("/user/"+UserFactory.User.athleteId+"/stats"),$scope.updateUser=function(){var httpPostObject={method:"POST",url:"/user/"+UserFactory.User._id+"/updateUser",data:$scope.model};$http(httpPostObject).success(function(data){console.log(data)})}}])}();
!function(){"use strict";angular.module("gh.strava.controllers",["gh.strava.factories.hr","gh.strava.factories.charts"]).controller("ActivitiesCtrl",["$scope","$http",function($scope,$http){$scope.model={activities:[]},$http.get("/act/1").success(function(data){$scope.model.activities=data})}]).controller("ActivitiesHRCtrl",["$scope","$stateParams","HRStreamFactory","DoughnutFactory",function($scope,$stateParams,HRStreamFactory,DoughnutFactory){$scope.chart={ctx:document.getElementById("myChart").getContext("2d"),doughnut:null},HRStreamFactory.processHRStream("/act/hr/"+$stateParams.id,function(data){0===Object.keys(data).length?console.log("No heart rate data for this activity"):DoughnutFactory.draw($scope.chart,data)})}])}(),function(){"use strict";angular.module("gh.strava.factories.charts",[]).factory("DoughnutFactory",function(){return{draw:function(chart,data){if(null===chart.doughnut)chart.doughnut=new Chart(chart.ctx).Doughnut(data);else for(var i=0;i<Object.keys(chart.data).length;i++)chart.doughnut.segments[i].value=data[i].value}}})}(),function(){"use strict";angular.module("gh.strava.factories.hr",[]).factory("HRStreamFactory",["$http",function($http){return{processHRStream:function(route,next){$http.get(route).success(function(data){next(0===Object.keys(data).length?{}:[{value:parseFloat(data.rest),color:"#ffe1e2",label:"Rest"},{value:parseFloat(data.z1),color:"#ffbbbd",label:"Zone 1"},{value:parseFloat(data.z2),color:"#fc9294",label:"Zone 2"},{value:parseFloat(data.z3),color:"#fc6468",label:"Zone 3"},{value:parseFloat(data.z4),color:"#f8363a",label:"Zone 4"},{value:parseFloat(data.z5),color:"#ef1419",label:"Zone 5"}])})}}}])}(),function(){"use strict";angular.module("gh.strava",["gh.strava.controllers","gh.strava.oauth","ui.router"]).config(["$stateProvider","$urlRouterProvider","$locationProvider",function($stateProvider,$urlRouterProvider,$locationProvider){$urlRouterProvider.otherwise("/"),$locationProvider.html5Mode(!0),$stateProvider.state("activities",{url:"/activities",templateUrl:"partials/activities",controller:"ActivitiesCtrl"}).state("activities.hr",{url:"/hr/{id}",templateUrl:["$stateParams",function($stateParams){return"partials/activities/hr/"+$stateParams.id}],controller:"ActivitiesHRCtrl"}).state("authorise",{url:"/",templateUrl:"partials/authorise",controller:"AuthoriseCtrl"}).state("exchange",{url:"/exchange?state&code",controller:"ExchangeCtrl",resolve:{code:["$stateParams",function($stateParams){return $stateParams.code}]}}).state("welcome",{url:"/welcome",templateUrl:"partials/welcome",controller:"WelcomeCtrl"})}])}(),function(){"use strict";angular.module("gh.strava.oauth",[]).controller("AuthoriseCtrl",["$scope","$http","$window",function($scope,$http,$window){$scope.authorise=function(){$http.get("/oauth/connect").success(function(data){$window.location.href=data})}}]).factory("Test",function(){var model={avatar:""};return{avatar:function(){return model.avatar},setAvatar:function(avatar){model.avatar=avatar}}}).controller("ExchangeCtrl",["$scope","$http","code","Test","$location",function($scope,$http,code,Test,$location){$http.get("/oauth/exchange?code="+code).success(function(data){Test.setAvatar(data.athlete.profile),$location.path("/welcome").search("")})}]).controller("WelcomeCtrl",["$scope","Test",function($scope,Test){$scope.avatar=Test.avatar(),console.log("in welcome ctrl")}])}();